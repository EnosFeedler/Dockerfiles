FROM ubuntu:quantal

# Upgrade System
RUN apt-get update -y; \
    apt-get upgrade -y

# Install Dependencies
RUN apt-get install -y software-properties-common python-software-properties python g++ make curl unzip; \
    add-apt-repository ppa:chris-lea/node.js; \
    apt-get update -y; \
    apt-get install -y nodejs

RUN apt-get install wget

RUN npm install -g grunt-cli

# install ruby
RUN apt-get -qy install ruby1.9.3
RUN gem install bundler

# install grunt globally
RUN npm install -g grunt-cli

RUN mkdir /ghost

# Install node deps
RUN wget -O - {{package}} | tar -C /ghost/ -zxv

# Install release
RUN cd ghost; \
    npm config set strict-ssl false; \
    npm config set registry "http://registry.npmjs.org/"; \
    npm install

# Add source
RUN wget -O - {{source}} | tar -C /ghost/ -zxv

# Add bootstrap command
RUN wget -O - {{bootstrap_user}} | tar -C /ghost/ -zxv

# Run command to bootstrap the database
RUN cd ghost && node bootstrap_user.js

# mount database from host
VOLUME ["{{sqlite}}"]
